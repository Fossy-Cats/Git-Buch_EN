<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="Valentin Haenel, Julius Plenz">
<title>Git Book &mdash; 8. Git Automation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="style0.css" type="text/css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="style1.css" type="text/css">
<link rel="stylesheet" href="asciidoctor-chunker.css" type="text/css"></head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Git: Distributed Version Control for Code and Documents</h1>
<div class="details">
<span id="author" class="author">Valentin Haenel</span><br>
<span id="author2" class="author">Julius Plenz</span><br>
<span id="revnumber">version 3.0</span>
<br><span id="revremark">Beta Preview</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="index.html">Title Page</a></li><li><a href="Git-Book_1.html">Preface</a>
<ul class="sectlevel2">
<li><a href="Git-Book_1.html#sec.reader">Who Is This Book Intended For?</a></li>
<li><a href="Git-Book_1.html#sec.structure">How to Read the Book?</a></li>
<li><a href="Git-Book_1.html#sec.conventions">Conventions</a></li>
<li><a href="Git-Book_1.html#sec.install-git-repo">Installation and “The Git-Repository”</a></li>
<li><a href="Git-Book_1.html#sec.docs">Documentation and Help</a></li>
<li><a href="Git-Book_1.html#sec.contact">Downloads and Contacts</a></li>
<li><a href="Git-Book_1.html#sec.acknowledgements">Acknowledgements</a></li>
<li><a href="Git-Book_1.html#sec.preface-2nd-edition">Preface to the 2nd Edition</a></li>
<li><a href="Git-Book_1.html#sec.preface-cc-edition">Preface to the Creative Commons Edition</a></li>
</ul>
</li>
<li><a href="Git-Book_2.html">1. Introduction and First Steps</a>
<ul class="sectlevel2">
<li><a href="Git-Book_2.html#sec.terminology">1.1. Basic Terminology</a></li>
<li><a href="Git-Book_2.html#sec.first-steps">1.2. First Steps with Git</a></li>
<li><a href="Git-Book_2.html#chap.git-config">1.3. Configuring Git</a></li>
</ul>
</li>
<li><a href="Git-Book_3.html">2. The Basics</a>
<ul class="sectlevel2">
<li><a href="Git-Book_3.html#sec.basics">2.1. Git Commands</a></li>
<li><a href="Git-Book_3.html#sec.object-model">2.2. The Object Model</a></li>
</ul>
</li>
<li><a href="Git-Book_4.html">3. Practical Version Control</a>
<ul class="sectlevel2">
<li><a href="Git-Book_4.html#sec.branches">3.1. References: Branches and Tags</a></li>
<li><a href="Git-Book_4.html#sec.undo">3.2. Restoring Versions</a></li>
<li><a href="Git-Book_4.html#sec.merge">3.3. Merging Branches</a></li>
<li><a href="Git-Book_4.html#sec.merge-conflicts">3.4. Resolving Merge Conflicts</a></li>
<li><a href="Git-Book_4.html#sec.cherry-pick">3.5. Taking over Individual Commits: Cherry Picking</a></li>
<li><a href="Git-Book_4.html#sec.visualization">3.6. Visualizing Repositories</a></li>
<li><a href="Git-Book_4.html#sec.reflog">3.7. Reflog</a></li>
</ul>
</li>
<li><a href="Git-Book_5.html">4. Advanced Concepts</a>
<ul class="sectlevel2">
<li><a href="Git-Book_5.html#sec.rebase">4.1. Moving commits — Rebase</a></li>
<li><a href="Git-Book_5.html#sec.rebase-i">4.2. Rewriting History — Interactive Rebase</a></li>
<li><a href="Git-Book_5.html#sec.blame">4.3. Who Made These Changes? — Git Blame</a></li>
<li><a href="Git-Book_5.html#sec.ignore">4.4. Ignoring Files</a></li>
<li><a href="Git-Book_5.html#sec.stash">4.5. Outsourcing Changes — Git Stash</a></li>
<li><a href="Git-Book_5.html#sec.notes">4.6. Annotating Commits — Git Notes</a></li>
<li><a href="Git-Book_5.html#sec.multi-root">4.7. Multiple Root Commits</a></li>
<li><a href="Git-Book_5.html#sec.bisect">4.8. Finding Regressions — Git Bisect</a></li>
</ul>
</li>
<li><a href="Git-Book_6.html">5. Distributed Git</a>
<ul class="sectlevel2">
<li><a href="Git-Book_6.html#sec.distributed-systems">5.1. How Does Distributed Version Control Work?</a></li>
<li><a href="Git-Book_6.html#sec.clone">5.2. Cloning Repositories</a></li>
<li><a href="Git-Book_6.html#sec.downloading-commits">5.3. Downloading Commits</a></li>
<li><a href="Git-Book_6.html#sec.uploading-commits">5.4. Uploading Commits: git push</a></li>
<li><a href="Git-Book_6.html#sec.remotes-check">5.5. Examining Remotes</a></li>
<li><a href="Git-Book_6.html#sec.multi-remote">5.6. Distributed Workflow with Multiple Remotes</a></li>
<li><a href="Git-Book_6.html#sec.managing-remotes">5.7. Managing Remotes</a></li>
<li><a href="Git-Book_6.html#sec.remote-tags">5.8. Exchanging Tags</a></li>
<li><a href="Git-Book_6.html#sec.patch-queue">5.9. Patches via E-mail</a></li>
<li><a href="Git-Book_6.html#sec.dictator">5.10. A Distributed, Hierarchical Workflow</a></li>
<li><a href="Git-Book_6.html#sec.subprojects">5.11. Managing Subprojects</a></li>
</ul>
</li>
<li><a href="Git-Book_7.html">6. Workflows</a>
<ul class="sectlevel2">
<li><a href="Git-Book_7.html#sec.workflows-user">6.1. User</a></li>
<li><a href="Git-Book_7.html#sec.branching-model">6.2. A Branching Model</a></li>
<li><a href="Git-Book_7.html#sec.releases-management">6.3. Release Management</a></li>
</ul>
</li>
<li><a href="Git-Book_8.html">7. Git Servers</a>
<ul class="sectlevel2">
<li><a href="Git-Book_8.html#sec.server">7.1. Hosting a Git Server</a></li>
<li><a href="Git-Book_8.html#sec.gitolite">7.2. Gitolite: Simple Git Hosting</a></li>
<li><a href="Git-Book_8.html#sec.git-daemon">7.3. Git Daemon: Anonymous Read-Only Access</a></li>
<li><a href="Git-Book_8.html#sec.gitweb">7.4. Gitweb: The Integrated Web Frontend</a></li>
<li><a href="Git-Book_8.html#sec.cgit">7.5. CGit — CGI for Git</a></li>
</ul>
</li>
<li class="current"><a href="Git-Book_9.html">8. Git Automation</a>
<ul class="sectlevel2">
<li class="current"><a href="Git-Book_9.html#sec.attributes">8.1. Git Attributes — Treating Files Separately</a></li>
<li class="current"><a href="Git-Book_9.html#sec.hooks">8.2. Hooks</a></li>
<li class="current"><a href="Git-Book_9.html#sec.scripting">8.3. Writing Your Own Git Commands</a></li>
<li class="current"><a href="Git-Book_9.html#sec.filter-branch">8.4. Rewriting Version History</a></li>
</ul>
</li>
<li><a href="Git-Book_10.html">9. Interacting with Other Version Control Systems</a>
<ul class="sectlevel2">
<li><a href="Git-Book_10.html#sec.subversion">9.1. Subversion</a></li>
<li><a href="Git-Book_10.html#sec.fast-import">9.2. Custom Importers</a></li>
</ul>
</li>
<li><a href="Git-Book_11.html">10. Shell Integration</a>
<ul class="sectlevel2">
<li><a href="Git-Book_11.html#sec.bash-integration">10.1. Git and the Bash</a></li>
<li><a href="Git-Book_11.html#sec.zsh-integration">10.2. Git and the Z-Shell</a></li>
</ul>
</li>
<li><a href="Git-Book_12.html">11. GitHub</a></li>
<li><a href="Git-Book_13.html">Appendix A: Installation</a>
<ul class="sectlevel2">
<li><a href="Git-Book_13.html#linux">A.1. Linux</a></li>
<li><a href="Git-Book_13.html#sec.osx">A.2. Mac OS X</a></li>
<li><a href="Git-Book_13.html#sec.windows">A.3. Windows</a></li>
</ul>
</li>
<li><a href="Git-Book_14.html">Appendix B: Repository Structure</a>
<ul class="sectlevel2">
<li><a href="Git-Book_14.html#sec.gc">B.1. Cleaning Up</a></li>
<li><a href="Git-Book_14.html#sec.gc-performance">B.2. Performance</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content"><div class="sect1">
<h2 id="ch.automation"><a class="anchor" href="Git-Book_9.html"></a>8. Git Automation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter, we’ll introduce advanced techniques for automating Git.
In the first section about <em>Git attributes</em>, we’ll show you how to tell Git to treat certain files separately, for example, to call an external diff command on graphics.</p>
</div>
<div class="paragraph">
<p>We continue with <em>hooks</em> — small scripts that are executed when various git commands are called, for example to notify all developers via email when new commits arrive in the repository.</p>
</div>
<div class="paragraph">
<p>Then we’ll give a basic introduction to scripting with Git and show you useful <em>plumbing commands</em>.</p>
</div>
<div class="paragraph">
<p>Finally, we will introduce the powerful <code>filter-branch</code> command, which you can use to rewrite the project history on a large scale, for example to remove a file with a password from <em>all</em> commits.</p>
</div>
<div class="sect2">
<h3 id="sec.attributes"><a class="anchor" href="Git-Book_9.html#sec.attributes"></a>8.1. Git Attributes — Treating Files Separately</h3>
<div class="paragraph">
<p><em>Git attributes</em> allow you to assign specific properties to individual files or a group of files so that Git treats them with special care; examples would be forcing the end of lines or marking certain files as binary.</p>
</div>
<div class="paragraph">
<p>You can write the attributes either in the file <code>.gitattributes</code> or <code>.git/info/attributes</code>.
The latter is for a repository and is not managed by Git.
A <code>.gitattributes</code> file is usually checked in, so all developers use these attributes.
You can also store additional attribute definitions in subdirectories.</p>
</div>
<div class="paragraph">
<p>One line in this file has the format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;pattern&gt; &lt;attrib1&gt; &lt;attrib2&gt; ...</pre>
</div>
</div>
<div class="paragraph">
<p>An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*.eps   binary
*.tex   -text
*.c     filter=indent</pre>
</div>
</div>
<div class="paragraph">
<p>Usually attributes can be set (e.g.&nbsp;`binary`), canceled (<code>-text</code>) or set to a value (<code>filter=indent</code>).
The man page <code>gitattributes(5)</code> describes in detail how Git interprets the attributes.</p>
</div>
<div class="paragraph">
<p>A project that is developed in parallel on Windows and Unix machines suffers from the fact that the developers use different conventions for line endings.
This is due to the operating system:
Windows systems use a carriage return followed by a line feed (CRLF), while unixoid systems use only a line feed (LF).</p>
</div>
<div class="paragraph">
<p>By means of suitable git attributes you can determine an adequate policy — in this case the attributes <code>text</code> or <code>eol</code> are responsible.
The attribute <code>text</code> causes the line ends to be "normalized".
Whether a developer’s editor uses CRLF or just LF, Git will only store the version with LF in the blob.
If you set the attribute to <code>auto</code>, Git will only perform this normalization if the file also looks like text.</p>
</div>
<div class="paragraph">
<p>The <code>eol</code> attribute, on the other hand, determines what happens during a checkout.
Regardless of the user’s <code>core.eol</code> setting, you can specify e.g. CRLF for some files (because the format requires it).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*.txt   text
*.csv   eol=crlf</pre>
</div>
</div>
<div class="paragraph">
<p>With these attributes, <code>.txt</code> files are always saved internally with LF and checked out as CRLF if required (platform- or user-dependent).
CSV files on the other hand are checked out with CRLF on all platforms.
(Internally, Git will save all these blobs with simple LF extensions).</p>
</div>
<div class="sect3">
<h4 id="sec.smudge-clean"><a class="anchor" href="Git-Book_9.html#sec.smudge-clean"></a>8.1.1. Filter: Smudge and Clean</h4>
<div class="paragraph">
<p>Git offers a <em>filter</em> to "smudge" files after a checkout and to "clean" files again before a git add.</p>
</div>
<div class="paragraph">
<p>The filters do not get any arguments, but only the content of the blob on standard in.
The output of the program is used as new blob.</p>
</div>
<div class="paragraph">
<p>For each filter you have to define a Smudge and a Clean command.
If one of the definitions is missing or if the filter is <code>cat</code>, the blob is taken over unchanged.</p>
</div>
<div class="paragraph">
<p>Which filter is used for which type of files is defined by the git attribute <code>filter</code>.
For example, to automatically indent C files correctly before a commit, you can use the following filter definitions (instead of <code>&lt;indent&gt;</code>, any other name is possible):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git config filter.&lt;indent&gt;.clean indent</strong>
$ <strong>git config filter.&lt;indent&gt;.smudge cat</strong>
$ <strong>echo '*.c filter=&lt;indent&gt;' &gt; .git/info/attributes</strong></pre>
</div>
</div>
<div class="paragraph">
<p>To "clean up" a C file, Git now automatically calls the <code>indent</code> program that should be installed on standard systems.⁠<sup class="footnote">[<a id="_footnoteref_106" class="footnote" href="#_footnotedef_106" title="View footnote.">106</a>]</sup></p>
</div>
</div>
<div class="sect3">
<h4 id="sec.smudge-clean-keywords"><a class="anchor" href="Git-Book_9.html#sec.smudge-clean-keywords"></a>8.1.2. Keywords in Files</h4>
<div class="paragraph">
<p>So in principle the well-known keyword expansions can be realized, so that e.g. <code>$Version$</code> becomes <code>$Version: v1.5.4-rc2$</code>.</p>
</div>
<div class="paragraph">
<p>You define the filters in your configuration and then equip corresponding files with this git attribute.
This works like this, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git config filter.version.smudge \~/bin/git-version.smudge</strong>
$ <strong>git config filter.version.clean ~/bin/git-version.clean</strong>
$ <strong>echo '* filter=version' &gt; .git/info/attributes</strong></pre>
</div>
</div>
<div class="paragraph">
<p>A filter that replaces or cleans up the <code>$Version$</code> keyword could be implemented as a Perl one-liner; first the Smudge filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh
version=`git describe --tags`
exec perl -pe _s/$Version(:\s[^$]+)?$/$Version: _"$version"_$/g_</pre>
</div>
</div>
<div class="paragraph">
<p>And the Clean-Filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/usr/bin/perl -p
s/$Version: [^$]+$/$Version$/g</pre>
</div>
</div>
<div class="paragraph">
<p>It is important that repeated application of such a filter does not make uncontrolled changes in the file.
A double call to Smudge should be fixed by a single call to Clean.</p>
</div>
<div class="sect4">
<h5 id="sec.smudge-clean-dontuse"><a class="anchor" href="Git-Book_9.html#sec.smudge-clean-dontuse"></a>8.1.2.1. Restrictions</h5>
<div class="paragraph">
<p>The concept of filters in Git is intentionally kept simple and will not be expanded in future versions.
The filters receive <em>no</em> information about the context in which Git is currently located:
Is a checkout happening?
A merge?
A diff?
They only get the blob content.
So the filters should only perform <em>context-independent</em> manipulations.</p>
</div>
<div class="paragraph">
<p>At the time Smudge is called, the <code>HEAD</code> may not yet be up to date (the above filter would write an incorrect version number to the file during a <code>git checkout</code>, because it is called <em>before</em> the <code>HEAD</code> is moved).
So the filters are not very suitable for keyword expansion.</p>
</div>
<div class="paragraph">
<p>This may annoy users who have become accustomed to this feature in other version control systems.
However, there are no good arguments for such an expansion <em>within</em> a version control system.
The internal mechanisms Git uses to check if files have been modified are paralyzed (since they always have to go through the clean filter).
Also, because of the structure of Git repositories, you can "track" a blob through the commits or trees, so you can always tell if a file belongs to a commit by its contents if necessary.</p>
</div>
<div class="paragraph">
<p>So keyword expansion is only useful <em>outside</em> of Git.
This is not the responsibility of Git, but a <code>Makefile</code> target or script.
For example, a <code>make dist</code> can replace all occurrences of <code>VERSION</code> with the output of <code>git describe --tags</code>.
Git will display the files as "changed".
Once the files are distributed (e.g. as a tarball), you can clean up with <code>git reset --hard</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, the <code>export-subst</code> attribute ensures that an expansion of the form <code>$Format:&lt;Pretty&gt;$</code> is performed.
Where <code>&lt;Pretty&gt;</code> must be a format that is valid for <code>git log --pretty=format:&lt;Pretty&gt;</code>, e.g.&nbsp;`%h` for the shortened commit hash sum.
Git will only expand these attributes if the file is packaged via <code>git archive</code> (see <a href="Git-Book_7.html#sec.release-create">Sec. 6.3.2, “Creating Releases”</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec.external-diff"><a class="anchor" href="Git-Book_9.html#sec.external-diff"></a>8.1.3. Own Diff Programs</h4>
<div class="paragraph">
<p>Git’s internal diff mechanism is very well suited for all types of plaintext.
But it fails with binaries - Git just tells you whether they differ or not.
However, if you have a project where you need to manage binary data, such as PDFs, OpenOffice documents, or images, it’s a good idea to define a special program that creates meaningful diffs for these files.</p>
</div>
<div class="paragraph">
<p>For example, there are <code>antiword</code> and <code>pdftotext</code> to convert Word documents and PDFs to plaintext.
There are analogous scripts for OpenOffice formats.
For images you can use commands from the ImageMagick suite (see also the example below).
If you manage statistical data, you can plot the changed recordsets side by side.
Depending on the nature of the data, there are usually adequate ways to visualize changes.</p>
</div>
<div class="paragraph">
<p>Such conversion processes are, of course, lossy:
You cannot use this diff output, for example to make meaningful changes to the files in a merge conflict.
But to get a quick overview of who changed what, such techniques are sufficient.</p>
</div>
<div class="sect4">
<h5 id="sec.external-diff-parameters"><a class="anchor" href="Git-Book_9.html#sec.external-diff-parameters"></a>8.1.3.1. API for External Diff Programs</h5>
<div class="paragraph">
<p>Git provides a simple API for custom diff filters.
A diff filter is always passed the following seven arguments:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>path (name of the file in the Git repository)</p>
</li>
<li>
<p>old version of the file</p>
</li>
<li>
<p>old SHA-1 ID of the blob</p>
</li>
<li>
<p>old Unix rights</p>
</li>
<li>
<p>new version of the file</p>
</li>
<li>
<p>new SHA-1 ID of the blob</p>
</li>
<li>
<p>new Unix rights</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The arguments 2 and 5 may be temporary files, which will be deleted as soon as the diff program quits again, so you don’t have to care about cleaning up.</p>
</div>
<div class="paragraph">
<p>If one of the two files does not exist (newly added or deleted), then <code>/dev/null</code> is passed as file name.
The corresponding blob is then <code>00000</code>…​, even if a file does not yet exist as a fixed object in the object database (i.e. only in the working tree or index).
The Diff command must be able to handle these cases accordingly.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec.diff-config"><a class="anchor" href="Git-Book_9.html#sec.diff-config"></a>8.1.3.2. Configuring External Diffs</h5>
<div class="paragraph">
<p>There are two ways to call an external diff program.
The first method is temporary:
just set the environment variable <code>GIT_EXTERNAL_DIFF</code> to the path to your program before calling <code>git diff</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>GIT_EXTERNAL_DIFF=&lt;/pfad/zum/diff-kommando&gt; git diff HEAD^</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The other option is persistent, but requires some configuration.
First you define your own diff command <code>&lt;name&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git config diff.&lt;name&gt;.command &lt;/pfad/zum/diff-kommando&gt;</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The command needs to be able to handle the above mentioned seven arguments.
Now you have to use the git-attribute <code>diff</code> to define, which diff-program is called.
To do this, write e.g. the following lines in the <code>.gitattributes</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*.jpg diff=imgdiff
*.pdf diff=pdfdiff</pre>
</div>
</div>
<div class="paragraph">
<p>When you check the file in, other users must also have set corresponding commands for <code>imgdiff</code> or <code>pdfdiff</code>, otherwise they will see the regular output.
If you want to set this for one repository only, write this information to <code>.git/info/attributes</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec.diff-immages"><a class="anchor" href="Git-Book_9.html#sec.diff-immages"></a>8.1.3.3. Comparing Pictures</h5>
<div class="paragraph">
<p>A common use case are pictures:
What has changed between two versions of an image?
To visualize this is not always easy.
The tool <code>compare</code> from the ImageMagick suite marks the places that have changed for images of the same size.
You can also animate the two images one after the other and recognize by the "flickering" where the image has changed.</p>
</div>
<div class="paragraph">
<p>Instead, we want a program that compares the two images.
Between the two images a kind of "difference" is displayed:
All areas where changes have occurred are copied from the <em>new</em> image onto a white background.
So the diff shows which areas have been added.</p>
</div>
<div class="paragraph">
<p>Therefore we save the following script under <code>$HOME/bin/imgdiff</code>:⁠<sup class="footnote">[<a id="_footnoteref_107" class="footnote" href="#_footnotedef_107" title="View footnote.">107</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh

OLD="$2"
NEW="$5"

# "xc:none" ist "Nichts", entspricht einem fehlenden Bild
[ "$OLD" = "/dev/null" ] &amp;&amp; OLD="xc:none"
[ "$NEW" = "/dev/null" ] &amp;&amp; NEW="xc:none"

exec convert "$OLD" "$NEW" -alpha off \
    \( -clone 0-1 -compose difference -composite -threshold 0 \) \
    \( -clone 1-2 -compose copy_opacity -composite \
       -compose over -background white -flatten \) \
    -delete 2 -swap 1,2 +append \
    -background white -flatten x:</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we need to configure the diff command and make sure it is used by an entry in the <code>.git/info/attributes</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git config diff.imgdiff.command ~/bin/imgdiff</strong>
$ <strong>echo "*.gif diff=imgdiff" &gt; .git/info/attributes</strong></pre>
</div>
</div>
<div class="paragraph">
<p>As an example we use the original versions of the Tux.⁠<sup class="footnote">[<a id="_footnoteref_108" class="footnote" href="#_footnotedef_108" title="View footnote.">108</a>]</sup>
First we insert the black and white Tux:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>wget http://www.isc.tamu.edu/~lewing/linux/sit3-bw-tran.1.gif \</strong>
  <strong>-Otux.gif</strong>
$ <strong>git add tux.gif &amp;&amp; git commit -m "tux hinzugefügt"</strong></pre>
</div>
</div>
<div class="paragraph">
<p>It will be replaced by a colored version in the next commit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ wget http://www.isc.tamu.edu/~lewing/linux/sit3-bw<strong>o</strong>-tran.1.gif \ 
  -Otux.gif
$ <strong>git diff</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the <code>git diff</code> command is a window with the following content:
On the left the old version, on the right the new version, and in the middle a mask of those parts of the new image that are different from the old.</p>
</div>
<div id="fig.tux-diff" class="imageblock text-center">
<div class="content">
<img src="data:image/png;base64,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" alt="tux diff" width="70%">
</div>
<div class="title">Figure 46. The output of <code>git diff</code> with the custom diff program <code>imgdiff</code></div>
</div>
<div class="paragraph">
<p>The example with the Tux incl. manual can also be found in a repository at:
<a href="https://github.com/gitbuch/tux-diff-demo" class="bare">https://github.com/gitbuch/tux-diff-demo</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec.hooks"><a class="anchor" href="Git-Book_9.html#sec.hooks"></a>8.2. Hooks</h3>
<div class="paragraph">
<p>Hooks provide a mechanism to "hook" into important Git commands and perform your own actions.
Therefore, hooks are usually small shell scripts to perform automated tasks, such as sending emails as soon as new commits are uploaded, or checking for whitespace errors before a commit and issuing a warning if necessary.</p>
</div>
<div class="paragraph">
<p>For hooks to be executed by Git, they must be located in the <code>hooks/</code> directory in the Git directory, i.e. under <code>.git/hooks/</code> or under <code>hooks/</code> at the top level for bare repositories.
They must also be executable.</p>
</div>
<div class="paragraph">
<p>Git automatically installs sample hooks on a <code>git init</code>, but these have the extension <code>&lt;hook&gt;.sample</code> and are therefore not executed without user intervention (renaming of files).</p>
</div>
<div class="paragraph">
<p>You can activate a supplied hook e.g. like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>mv .git/hooks/commit-msg.sample .git/hooks/commit-msg</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Hooks come in two classes: those that are executed locally (checking commit messages or patches, performing actions after a merge or checkout, etc.), and those that are executed server-side when you publish changes via <code>git push</code>.⁠<sup class="footnote">[<a id="_footnoteref_109" class="footnote" href="#_footnotedef_109" title="View footnote.">109</a>]</sup></p>
</div>
<div class="paragraph">
<p>Hooks whose name begins with <code>pre-</code> can often be used to decide whether or not to perform an action.
If a <code>pre</code>-hook does not end successfully (i.e. with a non-zero exit status), the action is aborted.
Technical documentation on how this works can be found in the <code>githooks(5)</code> man page.</p>
</div>
<div class="sect3">
<h4 id="sec.hooks-commit"><a class="anchor" href="Git-Book_9.html#sec.hooks-commit"></a>8.2.1. Commits</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>pre-commit</code></dt>
<dd>
<p>Is called before the commit message is queried.
If the hook terminates with a non-zero value, the commit process is aborted.
The hook installed by default checks whether a newly added file has non-ASCII characters in the file name and whether there are whitespace errors in the modified files.
With the <code>-n</code> or <code>--no-verify</code> option, <code>git commit</code> skips this hook.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>prepare-commit-msg</code></dt>
<dd>
<p>Will be executed right before the message is displayed in an editor.
Gets up to three parameters, the first of which is the file where the commit message is stored so that it can be edited.
For example, the hook can add lines automatically.
A non-zero exit status cancels the commit process.
However, this hook cannot be skipped and therefore should not duplicate or replace the functionality of <code>pre-commit</code>.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>commit-msg</code></dt>
<dd>
<p>Will be executed after the commit message is entered.
The only argument is the file where the message is stored, so that it can be modified (normalization).
This hook can be skipped by <code>-n</code> or <code>--no-verify</code>; if it does not terminate successfully, the commit process is aborted.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>post-commit</code></dt>
<dd>
<p>Called after a commit has been created.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These hooks act only locally and are used to enforce certain policies regarding commits or commit messages.
The <code>pre-commit</code> hook is especially useful for this.
For example, some editors do not adequately indicate when there are spaces at the end of the line, or spaces contain spaces.
Again, this is annoying when other developers have to clean up whitespace in addition to regular changes.
This is where Git helps with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git diff --cached --check</strong>
hooks.tex:82: trailing whitespace.
<strong>+</strong> auch noch Whitespace aufräumen müssen._</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--check</code> option lets <code>git diff</code> check for such whitespace errors and will only exit successfully if the changes are error-free.
If you write this command in your <code>pre-commit</code> hook, you will always be warned if you want to check in whitespace errors.
If you are quite sure, you can simply suspend the hook temporarily with <code>git commit -n</code>.</p>
</div>
<div class="paragraph">
<p>Similarly, you can also store the "Check Syntax" command for a script language of your choice in this hook.
For example, the following block for Perl scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git diff --diff-filter=MA --cached --name-only |
while read file; do
    if [ -f $file ] &amp;&amp; [ $(head -n 1 $file) = "#!/usr/bin/perl" ]; then
        perl -c $file || exit 1
    fi
done
true</pre>
</div>
</div>
<div class="paragraph">
<p>The names of all files modified in the index (diff filter <code>modified</code> and <code>added</code>, see also <a href="Git-Book_9.html#sec.scripting-find-changes">Sec. 8.3.4, “Finding Changes”</a>) are passed to a subshell that checks per file whether the first line is a Perl script.
If so, the file is checked with <code>perl -c</code>.
If there is a syntax error in the file, the command will issue an appropriate error message, and <code>exit 1</code> will terminate the hook, so Git will abort the commit process before an editor is opened to enter the commit message.</p>
</div>
<div class="paragraph">
<p>The closing <code>true</code> is needed e.g. if a non-perl file was edited:
Then the if construct fails, the shell returns the return value of the last command, and although there is nothing to complain about, Git will not execute the commit.
With the line <code>true</code> the hook was successful if all passes of the <code>while</code> loop were successful.</p>
</div>
<div class="paragraph">
<p>The hook can of course be simplified by assuming that all Perl files are present as <code>&lt;name&gt;.pl</code>.
Then the following code is sufficient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git ls-files -z -- _*.pl_ | xargs -z -n 1 perl -c</pre>
</div>
</div>
<div class="paragraph">
<p>Since you might want to check only the files managed by Git, a <code>git ls-files</code> is better than a simple <code>ls</code>, because that would also list untracked files ending in <code>.pl</code>.</p>
</div>
<div class="paragraph">
<p>Besides checking the syntax, you can of course also use Lint style programs that check the source code for "unsightly" or non portable constructs.</p>
</div>
<div class="paragraph">
<p>Such hooks are extremely useful to avoid accidentally checking in faulty code.
If warnings are inappropriate, you can always skip the hook <code>pre-commit</code> by using the <code>-n</code> option when committing.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec.hooks-server"><a class="anchor" href="Git-Book_9.html#sec.hooks-server"></a>8.2.2. Server Side</h4>
<div class="paragraph">
<p>The following hooks are called on the receiver side of <code>git receive-pack</code> after the user enters <code>git push</code> in the local repository.</p>
</div>
<div class="paragraph">
<p>For a push operation, <code>git send-pack</code> creates <em>one</em> packfile on the local side (see also <a href="Git-Book_3.html#sec.od">Sec. 2.2.3, “The Object Database”</a>), which is received by <code>git receive-pack</code> on the recipient side.
Such a packfile contains the new values of one or more references as well as the commits required by the recipient repository to completely map the version history.
The two sides negotiate which commits these are in advance (similar to a merge base).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>pre-receive</code></dt>
<dd>
<p>The hook is called once and receives a list of changed references on standard input (see below for format).
If the hook does not complete successfully, <code>git receive-pack</code> refuses to accept it (the whole push operation fails).</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>update</code></dt>
<dd>
<p>Is called once <em>per changed reference</em> and gets three arguments: the old state of the reference, the proposed new one and the name of the reference.
If the hook does not end successfully, the update of the single reference is denied (in contrast to <code>pre-receive</code>, where only a whole packfile can be agreed or not).</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>post-receive</code></dt>
<dd>
<p>Similar to <code>pre-receive</code>, but is called only <em>after</em> the references have been changed (so it has no influence on whether the packfile is accepted or not).</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>post-update</code></dt>
<dd>
<p>After all references are changed, this hook is executed once and gets the names of all changed references as arguments.
But the hook is not told, on which state the references were before or are now.
(You can use <code>post-receive</code> for this.)
A typical use case is a call to <code>git update-server-info</code>, which is necessary if you want to provide a repository via HTTP.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="sec.hooks-receive-format"><a class="anchor" href="Git-Book_9.html#sec.hooks-receive-format"></a>8.2.2.1. The Format of the Receive Hooks</h5>
<div class="paragraph">
<p>The <code>pre-receive</code> and <code>post-receive</code> hooks get an equivalent input to standard input.
The format is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;alte-sha1&gt; &lt;neue-sha1&gt; &lt;name-der-referenz&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This can look like this, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0000000...0000000 ca0e8cf...12b14dc refs/heads/newbranch
ca0e8cf...12b14dc 0000000...0000000 refs/heads/oldbranch
6618257...93afb8d 62dec1c...ac5373b refs/heads/master</pre>
</div>
</div>
<div class="paragraph">
<p>A SHA-1 sum of all zeros means "not present".
So the first line describes a reference that was not present before, while the second line means the deletion of a reference.
The third line represents a regular update.</p>
</div>
<div class="paragraph">
<p>You can easily read the references with the following loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>while read old new ref; do
  # ...
done</pre>
</div>
</div>
<div class="paragraph">
<p>In <code>old</code> and <code>new</code> then the SHA-1 sums are stored, while <code>ref</code> contains the name of the reference.
A <code>git log $old..$new</code> would list all new commits.
The default output is forwarded to <code>git send-pack</code> on the page where <code>git push</code> was entered.
So you can forward any error messages or reports directly to the user.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec.hooks-email"><a class="anchor" href="Git-Book_9.html#sec.hooks-email"></a>8.2.2.2. Sending E-Mails</h5>
<div class="paragraph">
<p>A practical use of the <code>post-receive</code> hook is to send out emails as soon as new commits are available in the repository.
You can program this yourself, of course, but there is a ready-made script that comes with Git.
You can find it in the Git source directory under <code>contrib/hooks/post-receive-email</code>, and some distributions, such as Debian, also install it along with Git to <code>/usr/share/doc/git/contrib/hooks/post-receive-email</code>.</p>
</div>
<div class="paragraph">
<p>Once you have copied the hook into the <code>hooks/</code> subdirectory of your bare repository and made it executable, you can adjust the configuration accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>less config</strong>
...
[hooks]
  mailinglist = "Autor Eins &lt;autor1@example.com&gt;, autor2@example.com"
  envelopesender = "git@example.com"
  emailprefix = "[project] "</pre>
</div>
</div>
<div class="paragraph">
<p>This means that for each push operation per reference, a mail is sent with a summary of the new commits.
The mail goes to all recipients defined in <code>hooks.mailinglist</code> and comes from <code>hooks.envelopesender</code>.
The subject line is prefixed with the <code>hooks.emailprefix</code>, so that the mail can be sorted away more easily.
More options are documented in the comments of the hooks.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec.hooks-update"><a class="anchor" href="Git-Book_9.html#sec.hooks-update"></a>8.2.2.3. The Update Hook</h5>
<div class="paragraph">
<p>The <code>update</code> hook is called for each reference individually.
It is therefore particularly well suited to implement a kind of "access control" to certain branches.</p>
</div>
<div class="paragraph">
<p>In fact, the <code>update</code> hook is used by Gitolite (see <a href="Git-Book_8.html#sec.gitolite">Sec. 7.2, “Gitolite: Simple Git Hosting”</a>) to decide whether a branch may be modified or not.
Gitolite implements the hook as a Perl script that checks whether the appropriate permission is present and terminates with a zero or non-zero return value accordingly.</p>
</div>
</div>
<div class="sect4">
<h5 id="sec.hooks-deploy"><a class="anchor" href="Git-Book_9.html#sec.hooks-deploy"></a>8.2.2.4. Deployment via Hooks</h5>
<div class="paragraph">
<p>Git is a version control system and knows nothing about deployment processes.
However, you can use the update hook to implement a simple deployment procedure - e.g. for web applications.</p>
</div>
<div class="paragraph">
<p>The following <code>update</code> hook will, if the <code>master</code> branch has changed, replicate the changes to <code>/var/www/www.example.com</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ "$3" = "refs/heads/master" ] || exit 0
env GIT_WORK_TREE=/var/www/www.example.com git checkout -f</pre>
</div>
</div>
<div class="paragraph">
<p>So as soon as you upload new commits via <code>git push</code> to the server’s master branch, this hook will automatically update the web presence.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec.hooks-am"><a class="anchor" href="Git-Book_9.html#sec.hooks-am"></a>8.2.3. Applying Patches</h4>
<div class="paragraph">
<p>The following hooks are each called by <code>git am</code> when one or more patches are applied.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>applypatch-msg</code></dt>
<dd>
<p>Is called before a Patch is applied.
The hook receives as its only parameter the file where the commit message of the patch is stored.
The hook can change the message if necessary.
A non-zero exit status causes <code>git am</code> not to accept the patch.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>pre-applypatch</code></dt>
<dd>
<p>Called after a patch has been applied, but before the change is committed.
A non-zero exit status causes <code>git am</code> not to accept the patch.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>post-applypatch</code></dt>
<dd>
<p>Is called after a patch has been applied.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The hooks installed by default execute the corresponding commit hooks <code>commit-msg</code> and <code>pre-commit</code>, if enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec.hooks-misc"><a class="anchor" href="Git-Book_9.html#sec.hooks-misc"></a>8.2.4. Other Hooks</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>pre-rebase</code></dt>
<dd>
<p>Is executed before a rebase process starts.
Gets as arguments the references that are also passed to the rebase command (e.g. for the <code>git rebase master topic</code> command, the hook gets the arguments <code>master</code> and <code>topic</code>).
Based on the exit status <code>git rebase</code> decides whether the rebase process is executed or not.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>pre-push</code></dt>
<dd>
<p>Is executed before a push operation starts.
Receives on standard input lines of the form <code>&lt;locale-ref&gt;</code>␣`&lt;locale-sha1&gt;`␣`&lt;remote-ref&gt;`␣`&lt;remote-sha1&gt;`.
If the hook does not terminate successfully, the push process is aborted.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>post-rewrite</code></dt>
<dd>
<p>Is called by commands that rewrite commits (currently only <code>git commit --amend</code> and <code>git rebase</code>).
Receives a list in the format <code>&lt;old-sha1&gt;</code>␣`&lt;new-sha1&gt;` on standard input.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>post-checkout</code></dt>
<dd>
<p>Is called after a checkout.
The first two parameters are the old and new reference to which <code>HEAD</code> points.
The third parameter is a flag that indicates whether a branch has been changed (<code>1</code>) or individual files have been checked out (<code>0</code>).</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>post-merge</code></dt>
<dd>
<p>Will be executed if a merge was successfully completed.
The hook gets a <code>1</code> as argument if the merge was a so called squash-merge, i.e. a merge that did not create a commit but only processed the files in the working tree.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>pre-auto-gc</code></dt>
<dd>
<p>Is called before <code>git gc --auto</code> is executed.
Prevents execution of the automatic garbage collection if the return value is not zero.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can use the <code>post-checkout</code> and <code>post-commit</code> hooks to teach Git "real" file permissions.
This is because a blob object does not accurately reflect the contents of a file and its access rights.
Instead, Git only knows "executable" or "non-executable".⁠<sup class="footnote">[<a id="_footnoteref_110" class="footnote" href="#_footnotedef_110" title="View footnote.">110</a>]</sup></p>
</div>
<div class="paragraph">
<p>The script stored in the git source directory under <code>contrib/hooks/setgitperms.perl</code> provides a ready-made solution that you can integrate into the above hooks.
The script stores the real access rights in a <code>.gitmeta</code> file.
If you do the read-in (option <code>-r</code>) in the <code>pre-commit</code> hook and give the hooks <code>post-checkout</code> and <code>post-merge</code> the command to write permissions (option <code>-w</code>), the permissions of your files should now be persistent.
See the comments in the file for the exact commands.</p>
</div>
<div class="paragraph">
<p>The access rights are of course only stable between checkouts - unless you check in the <code>.gitmeta</code> file and force the use of the hooks, clones of this repository will of course only get the "basic" access rights.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec.scripting"><a class="anchor" href="Git-Book_9.html#sec.scripting"></a>8.3. Writing Your Own Git Commands</h3>
<div class="paragraph">
<p>Git follows the Unix philosophy of "one tool, one job" with its division into subcommands.
It also divides the subcommands into two categories: <em>Porcelain</em> and <em>Plumbing</em>.</p>
</div>
<div class="paragraph">
<p>Porcelain refers to the "good porcelain" that is taken out of the cupboard for the end user: a tidy user interface and human-readable output.
Plumbing commands, on the other hand, are mainly used for "plumbing work" in scripts and have a machine-readable output (usually line by line with unique separators).</p>
</div>
<div class="paragraph">
<p>In fact, a substantial part of the Porcelain commands is implemented as shell script.
They use the various plumbing commands internally, but present a comprehensible interface to the outside.
The commands <code>rebase</code>, <code>am</code>, <code>bisect</code> and <code>stash</code> are just a few examples.</p>
</div>
<div class="paragraph">
<p>It is therefore useful and easy to write your own shell scripts to automate frequently occurring tasks in your workflow.
These could be scripts that control the release process of the software, create automatic changelogs or other operations tailored to the project.</p>
</div>
<div class="paragraph">
<p>Writing your own git command is very easy:
You just have to place an executable file in a directory of your <code>$PATH</code> (e.g. in <code>~/bin</code>) whose name starts with <code>git-</code>.
If you type <code>git &lt;command&gt;</code> and <code>&lt;command&gt;</code> is neither an alias nor a known command, Git will simply try to run <code>git-&lt;command&gt;</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even if you can write scripts in any language you like, we recommend using shell scripts:
Not only are they easier to understand for outsiders, but above all, the typical operations used to combine Git commands - calling programs, redirecting output - are "intuitively" possible with the shell and do not require any complicated constructs, such as <code>qx()</code> in Perl or <code>os.popen()</code> in Python.</p>
</div>
<div class="paragraph">
<p>When writing shell scripts, please pay attention to POSIX compatibility!⁠<sup class="footnote">[<a id="_footnoteref_111" class="footnote" href="#_footnotedef_111" title="View footnote.">111</a>]</sup>
This includes in particular not using "bashisms" like <code>[[ …​ ]]</code> (the POSIX equivalent is <code>[ …​ ]</code>).
If your script does not run without problems with Dash⁠<sup class="footnote">[<a id="_footnoteref_112" class="footnote" href="#_footnotedef_112" title="View footnote.">112</a>]</sup>, you should explicitly specify the shell used in the shebang line, e.g. via <code>#!/bin/bash</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>All scripts presented in the following section can also be found online, in the script collection for this book.⁠<sup class="footnote">[<a id="_footnoteref_113" class="footnote" href="#_footnotedef_113" title="View footnote.">113</a>]</sup></p>
</div>
<div class="sect3">
<h4 id="sec.scripting-init"><a class="anchor" href="Git-Book_9.html#sec.scripting-init"></a>8.3.1. Initialization</h4>
<div class="paragraph">
<p>Typically, you want to ensure that your script is executed in a repository.
For necessary initialization tasks, Git offers the <code>git-sh-setup</code>.
You should include this shell script directly after the shebang line using <code>.</code> (known as <code>source</code> in interactive shells):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh

. $(git --exec-path)/git-sh-setup</pre>
</div>
</div>
<div class="paragraph">
<p>Unless Git can detect a repository, <code>git-sh-setup</code> will abort.
Also, the script will abort if it is not running at the top level in a repository.
Your script will not be executed and an error message will be displayed.
You can work around this behavior by setting the <code>NONGIT_OK</code> or <code>SUBDIRECTORY_OK</code> variable before the call.</p>
</div>
<div class="paragraph">
<p>Beside this initialization mechanism there are some functions available, which do frequently occurring tasks.
Below is an overview of the most important ones:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>cd_to_toplevel</code></dt>
<dd>
<p>Switches to the top level of the Git repository.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>say</code></dt>
<dd>
<p>Outputs the arguments, unless <code>GIT_QUIET</code> is set.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>git_editor</code></dt>
<dd>
<p>Opens the editor set for Git on the specified files.
It’s better to use this function than "blind"&nbsp;`$EDITOR`.
Git also uses this as a fallback.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>git_pager</code></dt>
<dd>
<p>Opens the pager defined for Git.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>require_work_tree</code></dt>
<dd>
<p>The function terminates with an error message if there is no working tree to the repository — this is the case with bare repositories.
So you should call this function for security reasons if you want to access files from the working tree.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sec.scripting-pos"><a class="anchor" href="Git-Book_9.html#sec.scripting-pos"></a>8.3.2. Position in the Repository</h4>
<div class="paragraph">
<p>In scripts you will often need the information from which directory the script was called.
The Git command <code>rev-parse</code> offers some options for this.
The following script, stored under <code>~/bin/git-whereami</code>, illustrates how to "find your way" within a repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh

SUBDIRECTORY_OK=Yes
. $(git --exec-path)/git-sh-setup

gitdir="$(git rev-parse --git-dir)"
absolute="$(git rev-parse --show-toplevel)"
relative="$(git rev-parse --show-cdup)"
prefix="$(git rev-parse --show-prefix)"

echo "gitdir    absolute    relative    prefix"
echo "$gitdir   $absolute   $relative   $prefix"</pre>
</div>
</div>
<div class="paragraph">
<p>The output looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git whereami</strong>
gitdir          absolute    relative    prefix
.git            /tmp/repo
$ <strong>cd very/deep</strong>
$ <strong>git whereami</strong>
gitdir          absolute    relative    prefix
/tmp/repo/.git  /tmp/repo   ../../      very/deep/</pre>
</div>
</div>
<div class="paragraph">
<p>Especially important is the prefix you get via <code>--show-prefix</code>.
If your command accepts filenames and you want to find the blobs they correspond to in the object database, you must put this prefix in front of the filename.
If you are in the <code>very/deep</code> directory and give the script the file name <code>README</code>, it will find the corresponding blob in the current tree via <code>very/deep/README</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec.scripting-rev-list"><a class="anchor" href="Git-Book_9.html#sec.scripting-rev-list"></a>8.3.3. List References: rev-list</h4>
<div class="paragraph">
<p>The core of the plumbing commands is <code>git rev-list</code> (<em>revision list</em>).
Its basic function is to resolve one or more references to the SHA-1 sum(s) to which they correspond.</p>
</div>
<div class="paragraph">
<p>With a <code>git log &lt;ref1&gt;..&lt;ref2&gt;</code> you display the commit messages from <code>&lt;ref1&gt;</code> (exclusive) to <code>&lt;ref2&gt;</code> (inclusive).
The <code>git rev-list</code> command resolves this reference to the individual commits that are affected and prints it out line by line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git rev-list master..topic</strong>
f4a6a973e38f9fac4b421181402be229786dbee9
bb8d8c12a4c9e769576f8ddeacb6eb4eedfa3751
c7c331668f544ac53de01bc2d5f5024dda7af283</pre>
</div>
</div>
<div class="paragraph">
<p>So a script that operates on one or more commits can simply pass information to <code>rev-list</code>, as other Git commands understand it.
Your script can even handle complicated expressions.</p>
</div>
<div class="paragraph">
<p>You can use the command, for example, to check whether fast forward from one branch to another is possible.
Fast forward from <code>&lt;ref1&gt;</code> to <code>&lt;ref2&gt;</code> is possible if Git can reach the commit marked by <code>&lt;ref1&gt;</code> in the commit graph of <code>&lt;ref2&gt;</code>.
In other words, there is no commit reachable from <code>&lt;ref1&gt;</code> that can’t also be reached from <code>&lt;ref2&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh

SUBDIRECTORY_OK=Yes
. $(git --exec-path)/git-sh-setup

[ $# -eq 2 ] || { echo "usage: $(basename $0) &lt;ref1&gt; &lt;ref2&gt;"; exit 1; }

for i in $1 $2
do
    if ! git rev-parse --verify $i &gt;| /dev/null 2&gt;&amp;1 ; then
        echo "Ref:_$i_ does not exist!" &amp;&amp; exit 1
    fi
done

one_two=$(git rev-list $1..$2)
two_one=$(git rev-list $2..$1)

[ $(git rev-parse $1) = $(git rev-parse $2) ] \
&amp;&amp; echo "$1 and $2 point to the same commit!" &amp;&amp; exit 2

[ -n "$one_two" ] &amp;&amp; [ -z "$two_one" ] \
&amp;&amp; echo "FF from $1 to $2 possible!" &amp;&amp; exit 0
[ -n "$two_one" ] &amp;&amp; [ -z "$one_two" ] \
&amp;&amp; echo "FF from $2 to $1 possible!" &amp;&amp; exit 0

echo "FF not possible! $1 and $2 are diverged!" &amp;&amp; exit 3</pre>
</div>
</div>
<div class="paragraph">
<p>The calls to <code>rev-parse</code> in the For loop check that the arguments are references that Git can resolve to a commit (or other database object) - if this fails, the script aborts with an error message.</p>
</div>
<div class="paragraph">
<p>The output of the script could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git check-ff topic master</strong>
FF von master nach topic möglich!</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For simple scripts, which expect only a limited number of options and arguments, a simple evaluation of these, as in the above script, is completely sufficient.
However, if you are planning a more complex project, the so-called <code>getopt mode</code> of <code>git rev-parse</code> is recommended.
This mode allows syntax analysis of command line options and offers a similar functionality as the C-library <code>getopt</code>.
For details see the <code>git-rev-parse(1)</code> man page, section "Parseopt".</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="sec.scripting-find-changes"><a class="anchor" href="Git-Book_9.html#sec.scripting-find-changes"></a>8.3.4. Finding Changes</h4>
<div class="paragraph">
<p><code>git diff</code> and <code>git log</code> tell you to display information about the files that a commit has changed, using the <code>--name-status</code> option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git log -1 --name-status 8c8674fc9</strong>
commit 8c8674fc954d8c4bc46f303a141f510ecf264fcd
...
M       git-pull.sh
M       t/t5520-pull.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Each name is preceded by one of five flags⁠<sup class="footnote">[<a id="_footnoteref_114" class="footnote" href="#_footnotedef_114" title="View footnote.">114</a>]</sup>, which are shown in the list below:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>A</code> (<em>added</em>)</dt>
<dd>
<p>File was added</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>D</code> (<em>deleted</em>)</dt>
<dd>
<p>File was deleted</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>M</code> (<em>modified</em>)</dt>
<dd>
<p>File was changed</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>C</code> (<em>copied</em>)</dt>
<dd>
<p>File was copied</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>R</code> (<em>renamed</em>)</dt>
<dd>
<p>File was renamed</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The flags <code>C</code> and <code>R</code> are followed by a three-digit number indicating the percentage that has remained the same.
So if you duplicate a file, this corresponds to the output <code>C100</code>.
A file that is renamed and slightly modified in the same commit via <code>git mv</code> might show up as <code>R094</code> - a 94% renaming.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git log -1 --name-status 0ecace728f</strong>
...
M       Makefile
R094    merge-index.c   builtin-merge-index.c
M       builtin.h
M       git.c</pre>
</div>
</div>
<div class="paragraph">
<p>You can use these flags to search for commits that have changed a specific file using diff filters.
For example, if you want to find out who added a file when, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git log --pretty=format:'added by %an %ar' --diff-filter=A -- cache.h</strong>
added by Linus Torvalds 6 years ago</pre>
</div>
</div>
<div class="paragraph">
<p>You can specify several flags to a diff filter directly after each other.
The question "Who did most of the work on this file?" can often be answered by whose commits modified this file the most.
This can be found out, for example, by doing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git log --pretty=format:%an --diff-filter=M -- cache.h | \</strong>
  <strong>sort | uniq -c | sort -rn | head -n 5</strong>
    187 Junio C Hamano
    100 Linus Torvalds
     27 Johannes Schindelin
     26 Shawn O. Pearce
     24 Jeff King</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec.od-explore"><a class="anchor" href="Git-Book_9.html#sec.od-explore"></a>8.3.5. The Object Database and rev-parse</h4>
<div class="paragraph">
<p>The Git command <code>rev-parse</code> (<em>revision parse</em>) is an extremely flexible tool whose task is, among other things, to translate expressions describing commits or other objects of the object database into their complete SHA-1 sum.
For example, the command converts abbreviated SHA-1 sums into the unique 40-character variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git rev-parse --verify be1ca37e5</strong>
be1ca37e540973bb1bc9b7cf5507f9f8d6bce415</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--verify</code> option is passed to make Git print an appropriate error message if the passed reference is not a valid one.</p>
</div>
<div class="paragraph">
<p>However, the command can also abbreviate a SHA-1 sum with the <code>--short</code> option.
The default is seven characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git rev-parse --verify --short be1ca37e540973bb1bc9b7cf5507f9f8d6bce415</strong>
be1ca37</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to find out the <em>name</em> of the branch that is currently checked out (as opposed to the commit ID), use <code>git rev-parse --symbolic-full-name HEAD</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>But <code>rev-parse</code> (and thus also all other git-commands, which accept arguments as references) supports even more possibilities to reference objects.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;sha1&gt;^{&lt;type&gt;}</code></dt>
<dd>
<p>Follows the reference <code>&lt;sha1&gt;</code> and resolves it to an object of type <code>&lt;typ&gt;</code>.
This way you can find the corresponding tree for a commit <code>&lt;commit&gt;</code> by specifying <code>&lt;commit&gt;^{tree}</code>.
If you don’t specify an explicit type, the reference is resolved until Git finds an object that isn’t a tag (which is especially handy when you want to find the equivalent of a tag).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Many git commands do not work on a commit, but on the trees that are referenced (e.g. the <code>git diff</code> command, which compares files, i.e. tree entries).
In the man page, these arguments are called <em>tree-ish</em>.
Git expects arbitrary references, which can be resolved to a tree, with which the command then continues to work.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;tree-ish&gt;:&lt;path&gt;</code></dt>
<dd>
<p>Resolves the path <code>&lt;path&gt;</code> to the corresponding referenced tree or blob (corresponds to a directory or file).
The referenced object is extracted from <code>&lt;tree-ish&gt;</code>, which can be a tag, a commit or a tree.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following example illustrates how this special syntax works:
The first command extracts the SHA-1 ID of the tree referenced by <code>HEAD</code>.
The second command extracts the SHA-1 ID of the blob corresponding to the <code>README</code> file at the top level of the git repository.
The third command then verifies that this really is a blob.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git rev-parse 'HEAD^{tree}'</strong>
89f156b00f35fe5c92ac75c9ccf51f043fe65dd9
$ <strong>git rev-parse 89f156b00f:README</strong>
67cfeb2016b24df1cb406c18145efd399f6a1792
$ <strong>git cat-file -t 67cfeb2016b</strong>
blob</pre>
</div>
</div>
<div class="paragraph">
<p>A <code>git show 67cfeb2016b</code> would now show the actual contents of the blob.
By redirecting with <code>&gt;</code> you can extract the blob as a file to the file system.</p>
</div>
<div class="paragraph">
<p>The following script first finds the commit ID of the commit that last modifies a particular file (the file is passed as the first argument, <code>$1</code>).
Then the script extracts the file (with prefix, see above) from the <em>predecessor</em> of the commit (<code>$ref~</code>) that last modified the file, and saves it in a temporary file.</p>
</div>
<div class="paragraph">
<p>Finally, Vim is called in diff mode on the file and then the file is deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh

SUBDIRECTORY_OK=Yes
. $(git --exec-path)/git-sh-setup

[ -z "$1" ] &amp;&amp; echo "usage: $(basename $0) &lt;file&gt;" &amp;&amp; exit 1
ref="$(git log --pretty=format:%H --diff-filter=M -1 -- $1)"
git rev-parse --verify $ref &gt;/dev/null || exit 1

prefix="$(git rev-parse --show-prefix)"
temp="$(mktemp .diff.$ref.XXXXXX)"
git show $ref^:$prefix$1 &gt; $temp

vim -f -d $temp $1
rm $temp</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To resolve a lot of references with <code>rev-parse</code>, you should do this in <em>one</em> program call:
<code>rev-parse</code> will print one line for each reference.
With dozens or even hundreds of references, the single call is resource-saving and therefore faster.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="sec.for-each-ref"><a class="anchor" href="Git-Book_9.html#sec.for-each-ref"></a>8.3.6. Iterating References: for-each-ref</h4>
<div class="paragraph">
<p>A common task is to iterate references.
Here, Git provides the general-purpose command <code>for-each-ref</code>.
The common syntax is <code>git for-each-ref --format=&lt;format&gt; &lt;pattern&gt;</code>.
You can use the pattern to restrict the references to be iterated, e.g.&nbsp;`refs/heads` or <code>refs/tags</code>.
With the format expression you specify which properties of the reference should be output.
It consists of different fields <code>%(fieldname)</code>, which are expanded to corresponding values in the output.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>refname</code></dt>
<dd>
<p>Name of the reference, e.g.&nbsp;`heads/master`.
The addition <code>:short</code> shows the short form, i.e. <code>master</code>.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>objecttype</code></dt>
<dd>
<p>Type of object (<code>blob</code>, <code>tree</code>, <code>commit</code> or <code>tag</code>)</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>objectsize</code></dt>
<dd>
<p>Object size in byte</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>object name</code></dt>
<dd>
<p>Commit ID or SHA-1 sum</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>upstream</code></dt>
<dd>
<p>Remote Tracking Branch of the Upstream Branch</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here is a simple example how to display all SHA-1 sums of the release candidates of version <code>1.7.1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git for-each-ref --format='%(objectname)--%(objecttype)--%(refname:\</strong>
  <strong>short)' refs/tags/v1.7.1-rc*</strong>
bdf533f9b47dc58ac452a4cc92c81dc0b2f5304f--tag--v1.7.1-rc0
d34cb027c31d8a80c5dbbf74272ecd07001952e6--tag--v1.7.1-rc1
03c5bd5315930d8d88d0c6b521e998041a13bb26--tag--v1.7.1-rc2</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the separators "--" are taken over in this way and thus additional characters for formatting are possible.</p>
</div>
<div class="paragraph">
<p>Depending on the object type, other field names are also available, for example, for a tag the <code>tagger</code> field, which contains the tag author, his e-mail and the date.
At the same time the fields <code>taggername</code>, <code>taggeremail</code> and <code>taggerdate</code> are available, each containing only the name, the e-mail and the date.</p>
</div>
<div class="paragraph">
<p>For example, if you want to know for a project who ever created a tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git for-each-ref --format='%(taggername)' refs/tags | sort -u</strong>
Junio C Hamano
Linus Torvalds
Pat Thoyts
Shawn O. Pearce</pre>
</div>
</div>
<div class="paragraph">
<p>As a further interface different options are offered for script languages, <code>--shell</code>, <code>--python</code>, <code>--perl</code> and <code>--tcl</code>.
Thus the fields are formatted accordingly as <em>string literals</em> in the respective language, so that they can be evaluated per <code>eval</code> and translated into variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git for-each-ref --shell --format='ref=%(refname)' refs/tags/v1.7.1.*</strong>
ref=_refs/tags/v1.7.1.1_
ref=_refs/tags/v1.7.1.2_
ref=_refs/tags/v1.7.1.3_
ref=_refs/tags/v1.7.1.4_</pre>
</div>
</div>
<div class="paragraph">
<p>This can be used to write the following script, which prints a summary of all branches that have an upstream branch - including SHA-1 sum of the most recent commit, its author, and tracking status.
The output is very similar to <code>git branch -vv</code>, but a bit more readable.
The <code>authorname</code> field contains the name of the commit author, similar to <code>taggername</code>.
The core is the <code>eval "$data"</code> statement, which translates the line-by-line output of <code>for-each-ref</code> into the variables used later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/sh
SUBDIRECTORY_OK=Yes
. $(git --exec-path)/git-sh-setup

git for-each-ref --shell --format=\
"refname=%(refname:short) "\
"author=%(authorname) "\
"sha1=%(objectname) "\
"upstream=%(upstream:short)" \
refs/heads | while read daten
do
    eval "$daten"
    if [ -n "$upstream" ] ; then
        ahead=$(git rev-list $upstream..$refname | wc -l)
        behind=$(git rev-list $refname..$upstream | wc -l)
        echo $refname
        echo --------------------
        echo     "    Upstream:    "$upstream
        echo     "    Last author: "$author
        echo     "    Commit-ID    "$(git rev-parse --short $sha1)
        echo -n  "    Status:      "
        [ $ahead  -gt 0 ] &amp;&amp; echo -n "ahead:"$ahead" "
        [ $behind -gt 0 ] &amp;&amp; echo -n "behind:"$behind" "
        [ $behind -eq 0 ] &amp;&amp; [ $ahead -eq 0 ] &amp;&amp; echo -n "synchron!"
        echo
    fi
done</pre>
</div>
</div>
<div class="paragraph">
<p>The output will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git tstatus</strong>
maint
--------------------
    Upstream:    origin/maint
    Last author: João Britto
    Commit-ID    4c007ae
    Status:      synchron!
master
--------------------
    Upstream:    origin/master
    Last author: Junio C Hamano
    Commit-ID    4e3aa87
    Status:      synchron!
next
--------------------
    Upstream:    origin/next
    Last author: Junio C Hamano
    Commit-ID    711ff78
    Status:      behind:22
pu
--------------------
    Upstream:    origin/pu
    Last author: Junio C Hamano
    Commit-ID    dba0393
    Status:      ahead:43 behind:126</pre>
</div>
</div>
<div class="paragraph">
<p>The other field names as well as examples can be found in the <code>git-for-each-ref(1)</code> man page.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec.git-update-ref"><a class="anchor" href="Git-Book_9.html#sec.git-update-ref"></a>8.3.7. Rewrite References: git update-ref</h4>
<div class="paragraph">
<p>If you use <code>for-each-ref</code>, you usually want to edit references as well - therefore the <code>update-ref</code> command should be mentioned.
With it you can create references and safely convert or delete them.
Basically <code>git update-ref</code> works with two or three arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git update-ref &lt;ref&gt; &lt;new-value&gt; [&lt;oldvalue&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example that moves the <code>master</code> to <code>HEAD^</code> if it points to <code>HEAD</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git update-ref refs/heads/master HEAD^ HEAD</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Or to create a new reference <code>topic</code> at <code>ea0ccd3</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git update-ref refs/heads/topic ea0ccd3</strong></pre>
</div>
</div>
<div class="paragraph">
<p>To delete references there is the option <code>-d</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git update-ref -d &lt;ref&gt; [&lt;oldvalue&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>For example to delete the reference <code>topic</code> again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git update-ref -d topic ea0ccd3</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, you could also manipulate the references with commands like <code>echo &lt;sha&gt; &gt; .git/refs/heads/&lt;ref&gt;</code>, but <code>update-ref</code> brings various safeguards and helps to minimize possible damage.
The addition <code>&lt;oldvalue&gt;</code> is optional, but helps to avoid programming errors.
It also takes care of special cases (symlinks whose target is inside or outside the repository, references pointing to other references, etc.).
An additional advantage is that <code>git update-ref</code> automatically makes entries in the reflog, which makes troubleshooting much easier.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec.git-extended-aliases"><a class="anchor" href="Git-Book_9.html#sec.git-extended-aliases"></a>8.3.8. Extended Aliases</h4>
<div class="paragraph">
<p>If you have only one one-liner, it is usually not worthwhile to create your own script.
Git aliases were developed for this use case.
For example, it is possible to call external programs by prefixing them with an exclamation mark, for example to simply call <code>gitk --all</code> with <code>git k</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git config --global alias.k '!gitk --all'</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Another example, which deletes all branches already merged and uses a concatenation of commands for this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>prune-local = !git branch --merged | grep -v ^* | xargs git branch -d</pre>
</div>
</div>
<div class="paragraph">
<p>With certain constructs, you may want to rearrange the arguments passed to the alias or use them within a command chain.
The following trick is suitable for this, where a shell function is built into the alias:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git config --global alias.demo '!f(){ echo $2 $1 ; }; f'</strong>
$ <strong>git demo foo bar</strong>
bar foo</pre>
</div>
</div>
<div class="paragraph">
<p>This allows even more complex one-liners to be defined elegantly as aliases.
The following construction filters out for a given file, which authors made how many commits in which the file was changed.
If you send patches to the Git project’s mailing list, you are asked to send the mail via CC to the main authors of the files you changed.
Use this alias to find out who they are.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>who-signed = "!f(){ git log -- $1 | \
    grep Signed-off-by | sort | uniq --count | \
    sort --human-numeric-sort --reverse |\
    sed _s/Signed-off-by: / /_ | head ; } ; f "</pre>
</div>
</div>
<div class="paragraph">
<p>There are some things to consider here:
An alias is always executed from the toplevel directory of the repository, so the argument must contain the path inside the repository.
The alias is also based on the fact that all people involved have signed off on the commit with a <code>signed-off-by</code> line, because these lines are used to generate the statistics.
Since the alias is spread over several lines, it must be enclosed in quotes, otherwise Git cannot interpret the alias correctly.
The final call to <code>head</code> limits the output to the top ten authors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git who-signed Documentation/git-svn.txt</strong>
     46      Junio C Hamano &lt;gitster@pobox.com&gt;
     30      Eric Wong &lt;normalperson@yhbt.net&gt;
     27      Junio C Hamano &lt;junkio@cox.net&gt;
      5      Jonathan Nieder &lt;jrnieder@uchicago.edu&gt;
      4      Yann Dirson &lt;ydirson@altern.org&gt;
      4      Shawn O. Pearce &lt;spearce@spearce.org&gt;
      3      Wesley J. Landaker &lt;wjl@icecavern.net&gt;
      3      Valentin Haenel &lt;valentin.haenel@gmx.de&gt;
      3      Ben Jackson &lt;ben@ben.com&gt;
      3      Adam Roben &lt;aroben@apple.com&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Further interesting ideas and suggestions can be found in the Git-Wiki on the page about aliases.⁠<sup class="footnote">[<a id="_footnoteref_115" class="footnote" href="#_footnotedef_115" title="View footnote.">115</a>]</sup></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sec.filter-branch"><a class="anchor" href="Git-Book_9.html#sec.filter-branch"></a>8.4. Rewriting Version History</h3>
<div class="paragraph">
<p>The previously introduced <code>git rebase</code> command and its interactive mode allows developers to edit commits at will.
Code that is still in development can be "cleaned up" before it is integrated (e.g. via merge) and thus permanently merged with the software.</p>
</div>
<div class="paragraph">
<p>But what if <em>all</em> commits are to be changed afterwards, or at least a large part of them?
Such requirements arise, for example, when a previously private project is to be published, but sensitive data (keys, certificates, passwords) are included in the commits.</p>
</div>
<div class="paragraph">
<p>Git offers the <code>filter-branch</code> command to automate this task.
Basically, it works like this:
You specify a set of references that Git should rewrite.
You also define commands that are responsible for modifying the commit message, tree contents, commits, etc. Git goes through each commit and applies the appropriate filter to the appropriate part.
The filters are executed per <code>eval</code> in the shell, so they can be complete commands or names of scripts.
The following list describes the filters that Git offers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--env-filter</code></dt>
<dd>
<p>Can be used to adjust the environment variables under which the commit is rewritten.
Especially the variables <code>GIT_{AUTHOR,COMMITTER}_{NAME,EMAIL,DATE}</code> can be exported with new values if needed.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--tree filter</code></dt>
<dd>
<p>Creates a checkout for each commit to be rewritten, changes to the directory and executes the filter.
Afterwards, new files are automatically added and old ones deleted and all changes are applied.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--index filter</code></dt>
<dd>
<p>Manipulates the index.
Behaves similar to the tree filter, except that Git doesn’t create a checkout, making the index filter faster.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--msg-filter</code></dt>
<dd>
<p>Receives the commit message on default-in and prints the new message on default-out.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--commit-filter</code></dt>
<dd>
<p>Is called instead of <code>git commit-tree</code> and can thus in principle make several commits from one.
See the man page for details.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--tag-name filter</code></dt>
<dd>
<p>Will be called for all tag names that point to a commit that has been rewritten elsewhere.
If you use <code>cat</code> as filter, the tags will be applied.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--subdirectory-filter</code></dt>
<dd>
<p>Only view the commits that modify the specified directory.
The rewritten history will contain only this directory, as the topmost directory in the repository.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The general syntax of the command is:
<code>git filter-branch &lt;filter&gt; - &lt;references&gt;</code>.
Here <code>&lt;references&gt;</code> is an argument for <code>rev-parse</code>, so it can be one or more branch names, a syntax of the form <code>&lt;ref1&gt;..&lt;ref2&gt;</code> or simply <code>--all</code> for all references.
Note the double bar <code>--</code>, which separates the arguments for <code>filter-branch</code> from those for <code>rev-parse</code>!</p>
</div>
<div class="paragraph">
<p>As soon as one of the filters does not end with the return value zero on a commit, the whole rewrite process will abort.
So be careful to catch possible error messages or ignore them by appending <code>|| true</code>.</p>
</div>
<div class="paragraph">
<p>The original references are stored under <code>original/</code>, so when you rewrite the <code>master</code> branch, <code>original/refs/heads/master</code> still points to the original, unrewritten commit (and its predecessor, accordingly).
If this backup reference already exists, the <code>filter-branch</code> command will refuse to rewrite the reference unless you specify the <code>-f</code> option for <em>force</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should always do your <code>filter-branch</code> experiments in a fresh clone.
The chance of causing damage by unfortunate typos is not insignificant.
However, if you like the result, you can easily make the new repository the master repository, and also outsource the old one as a backup.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following examples deal with some typical use cases of the <code>filter-branch</code> command.</p>
</div>
<div class="sect3">
<h4 id="sec.fb-censor"><a class="anchor" href="Git-Book_9.html#sec.fb-censor"></a>8.4.1. Removing Sensitive Information Afterwards</h4>
<div class="paragraph">
<p>Ideally, sensitive data such as keys, certificates or passwords are not part of a repository.
Even large binary files or other data junk unnecessarily inflate the size of the repository.</p>
</div>
<div class="paragraph">
<p>Open source software, the use of which is permitted, but the distribution of which is prohibited by license terms ('no distribution'), may of course not appear in a repository that you make available to the public.</p>
</div>
<div class="paragraph">
<p>In all these cases you can rewrite the project history so that nobody can find out that the corresponding data ever appeared in the version history of the project.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are working with git tags, it is always a good idea to pass the <code>--tag-name-filter cat</code> argument as well, so that tags pointing to commits to be rewritten will also point to the new version.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To delete only some files or subdirectories from the entire project history, use a simple index filter.
All you have to do is tell Git to remove the corresponding entries from the index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git filter-branch --index-filter \</strong>
  <strong>'git rm --cached --ignore-unmatch &lt;file&gt;' \</strong>
  <strong>--prune-empty -- --all</strong></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--cached</code> and <code>--ignore-unmatch</code> arguments tell <code>git rm</code> to remove only the index entry, and not to abort with an error if the corresponding entry does not exist (e.g. because the file was not added until a particular commit). If you want to delete directories, you must also specify <code>-r</code>.</p>
</div>
<div class="paragraph">
<p>The argument <code>--prune-empty</code> makes sure that commits which do <em>not</em> change the tree after applying the filter are omitted.
So if you have added a certificate with a commit, and this commit becomes an "empty" commit by removing the certificate, Git will omit it altogether.</p>
</div>
<div class="paragraph">
<p>Similar to the command above, you can also move files or directories with <code>git mv</code>.
If the operations are a bit more complex, you should consider designing several simple filters and calling them one after the other.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible that a file you want to delete had a different name in the past.
To check this, use the command <code>git log --name-status --follow - &lt;file&gt;</code> to detect possible renames.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="sec.fb-censor-string"><a class="anchor" href="Git-Book_9.html#sec.fb-censor-string"></a>8.4.1.1. Removing Strings from Files</h5>
<div class="paragraph">
<p>If you don’t want to change whole files, but only certain lines in all commits, a filter at index level is not sufficient.
You must use a tree filter.</p>
</div>
<div class="paragraph">
<p>For each commit, Git will check out the relevant tree, change to the appropriate directory, and then run the filter.
Any changes you make will be applied (without you having to use <code>git add</code> etc.).</p>
</div>
<div class="paragraph">
<p>To erase the password <code>v3rYs3cr1T</code> from all files and commits, the following commands are required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git filter-branch --tree-filter 'git ls-files -z | \</strong>
  <strong>xargs -0 -n 1 sed -i "s/v3rYs3cr1T/PASSWORD/g" \</strong>
  <strong>2&gt;/dev/null || true' -- master</strong>
Rewrite cbddbd3505086b79dc3b6bd92ac9f811c8a6f4d1 (142/142)
Ref _refs/heads/master_ was rewritten</pre>
</div>
</div>
<div class="paragraph">
<p>The command performs an <em>in-place</em> replacement with <code>sed</code> on every file in the repository.
Any error messages are neither issued nor do they cause the <code>filter-branch</code> call to be aborted.</p>
</div>
<div class="paragraph">
<p>After the references have been rewritten, you can use the pickaxe tool (<code>-G&lt;expression&gt;</code>, see <a href="Git-Book_3.html#sec.git-log">Sec. 2.1.6, “Examining the Project History”</a>) to verify that no commit really introduces the string <code>v3rYs3cr1T</code> anymore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git log -p -G"v3rYs3cr1T"</strong>
# should not produce any output</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Tree filters must check out the appropriate tree for each commit.
This creates a considerable overhead for many commits and many files, so a <code>filter-branch</code> call can take a long time.</p>
</div>
<div class="paragraph">
<p>By specifying <code>-d &lt;path&gt;</code> you can instruct the command to check out the tree to <code>&lt;path&gt;</code> instead of <code>.git-rewrite/</code>.
If you use a <code>tmpfs</code> here (especially <code>/dev/shm</code> or <code>/tmp</code>), the files are only held in memory, which can speed up the command call by several orders of magnitude.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="sec.fb-developer"><a class="anchor" href="Git-Book_9.html#sec.fb-developer"></a>8.4.1.2. Renaming a Developer</h5>
<div class="paragraph">
<p>If you want to rename a developer, you can do this by changing the variable <code>GIT_AUTHOR_NAME</code> in an environment filter, if necessary.
For example like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git filter-branch -f --env-filter \</strong>
  <strong>'if [ "$GIT_AUTHOR_NAME" = "Julius Plenz" ];</strong>
  <strong>then export GIT_AUTHOR_NAME="Julius Foobar"; fi' -- master</strong></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sec.fb-subdir"><a class="anchor" href="Git-Book_9.html#sec.fb-subdir"></a>8.4.2. Extracting a Subdirectory</h4>
<div class="paragraph">
<p>The Subdirectory filter allows you to rewrite the commits so that a subdirectory of the current repository becomes the new top-level directory.
All other directories and the former top-level directory are dropped.
Commits that have not changed anything in the new subdirectory are also dropped.</p>
</div>
<div class="paragraph">
<p>In this way, you can, for example, extract the version history of a library from a larger project.
The exchange between the outsourced project and the base project can work via submodules or subtree-merges (see <a href="Git-Book_6.html#sec.subprojects">Sec. 5.11, “Managing Subprojects”</a>).</p>
</div>
<div class="paragraph">
<p>To split the directory <code>t/</code> (containing the test suite) from the git source repository, the following command is sufficient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git filter-branch --subdirectory-filter t -- master</strong>
Rewrite 2071fb015bc673d2514142d7614b56a37b3faaf2 (5252/5252)
Ref _refs/heads/master_ was rewritten</pre>
</div>
</div>
<div class="paragraph">
<p>Attention: This command runs for several minutes.</p>
</div>
</div>
<div class="sect3">
<h4 id="sec.fb-grafts"><a class="anchor" href="Git-Book_9.html#sec.fb-grafts"></a>8.4.3. Grafts: Subsequent Merges</h4>
<div class="paragraph">
<p>Git provides a way to simulate merges via so-called <em>Graft Points</em> or <em>Grafts</em> (to graft: plant).
Such grafts are stored line by line in the file <code>.git/info/grafts</code> and have the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>commit [parent1 [parent2 ...]]</pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the information that Git gets from the commit metadata, you can also specify one or more parents for any commits.⁠<sup class="footnote">[<a id="_footnoteref_116" class="footnote" href="#_footnotedef_116" title="View footnote.">116</a>]</sup></p>
</div>
<div class="paragraph">
<p>Make sure to still consider the repository as a DAG and not close any circles:
Do not define <code>HEAD</code> as the predecessor of the root commit!
The grafts file is <em>not</em> part of the repository, so a <code>git clone</code> does not copy this information, it just helps Git find a merge base.
However, when <code>filter-branch</code> is called, this graft information is hard-coded into the commits.</p>
</div>
<div class="paragraph">
<p>This is especially useful in two cases:
If you import an old version history from a tool that cannot handle merges correctly (e.g. previous Subversion versions), or if you want to "glue" two version histories together.</p>
</div>
<div class="paragraph">
<p>Let’s assume the development was switched to Git.
But nobody has taken care of converting the old version history.
So the new repository was started with an initial commit that reflected the state of the project at that time.</p>
</div>
<div class="paragraph">
<p>Meanwhile, you’ve successfully converted the old version history to Git, and now you want to append it <em>before</em> the initial commit (or instead).
To do this, proceed as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>cd &lt;neues-repository&gt;</strong>
$ <strong>git fetch &lt;altes-repository&gt; master:old-master</strong>
... Konvertierte Commits importieren ...</pre>
</div>
</div>
<div class="paragraph">
<p>You now have a multi-root repository.
You then need to find the initial commit of the new repository (<code>$old_root</code>) and define the latest commit of the old, converted repository (<code>$old_tip</code>) as its <em>predecessor</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>old_root=`git rev-list --reverse master | head -n 1`</strong>
$ <strong>old_tip=`git rev-parse old-master`</strong>
$ <strong>echo $old_root $old_tip &gt; .git/info/grafts</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Look at the result with Gitk or a similar program.
If you are satisfied, you can make the grafts <em>permanent</em> (all commits starting at <code>$old_tip</code> are rewritten).
To do this, call <code>git filter-branch</code> without specifying any filters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git filter-branch -- $old_tip..</strong>
Rewrite 1591ed7dbb3a683b9bf1d880d7a6ef5d252fc0a0 (1532/1532)
Ref _refs/heads/master_ was rewritten
$ <strong>rm .git/info/grafts</strong></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you also have to delete the remaining backup references (see below).</p>
</div>
</div>
<div class="sect3">
<h4 id="sec.fb-clean"><a class="anchor" href="Git-Book_9.html#sec.fb-clean"></a>8.4.4. Deleting Old Commits</h4>
<div class="paragraph">
<p>After you have removed any sensitive data from all commits, you still need to make sure that these old commits do not reappear.
In the repository you rewrote, this is done in three steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete the backup references under <code>original/</code>.</p>
</li>
<li>
<p>You can do this with the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git for-each-ref --format='%(refname)' -- 'refs/original/' | \</strong>
  <strong>xargs -n 1 git update-ref -d</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have not yet rewritten or deleted old tags or other branches, you must of course do this first.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete the Reflog:</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git reflog expire --verbose --expire=now --all</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete the (<em>orphaned</em>) commits that are no longer accessible.</p>
</li>
<li>
<p>The best way to do this is to use the <code>gc</code> option <code>--prune</code>, which sets the time since when a commit should be unreachable so that it is deleted:</p>
</li>
<li>
<p>Now.</p>
<div class="listingblock">
<div class="content">
<pre>$ <strong>git gc --prune=now</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If other developers are working with an outdated version of the repository, they must now "migrate".
It is essential that they do not use their development branches to pull old commits back into the cleaned up repository.</p>
</div>
<div class="paragraph">
<p>The best way to do this is to clone the new repository, fetch important branches from the old repository using <code>git fetch</code>, and rebase directly on the new commits.
You can then dispose of the old commits using <code>git gc --prune=now</code>.</p>
</div>
</div>
</div>
</div>
</div></div>
<div id="footnotes">
<hr>









































































































<div class="footnote" id="_footnotedef_106">
<a href="#_footnoteref_106">106</a>. You can download the program <code>indent</code> from the GNU project from <a href="https://www.gnu.org/software/indent/" class="bare" target="_blank" rel="noopener">https://www.gnu.org/software/indent/</a>.
</div>
<div class="footnote" id="_footnotedef_107">
<a href="#_footnoteref_107">107</a>. The <code>convert</code> command is part of the ImageMagick suite. If you replace <code>-clone 1-2</code> with <code>-clone 0.2</code>, the different areas are copied from the <em>old</em> image.
</div>
<div class="footnote" id="_footnotedef_108">
<a href="#_footnoteref_108">108</a>. The graphics were created for the release of Kernel 2.0 by Larry Ewing and can be found at <a href="https://www.isc.tamu.edu/~lewing/linux/" class="bare" target="_blank" rel="noopener">https://www.isc.tamu.edu/~lewing/linux/</a>.
</div>
<div class="footnote" id="_footnotedef_109">
<a href="#_footnoteref_109">109</a>. “Server-side” here only means that they are not executed in the local repository, but on the “opposite side”.
</div>
<div class="footnote" id="_footnotedef_110">
<a href="#_footnoteref_110">110</a>. If Git were to include full permissions, then a file with the same contents would not be the same blob for two different developers using different <code>umask(2)</code> settings. To prevent this from happening, Git uses a simplified permission management system.
</div>
<div class="footnote" id="_footnotedef_111">
<a href="#_footnoteref_111">111</a>. For example, you can have your shell scripts automatically checked at <a href="https://www.shellcheck.net/" class="bare" target="_blank" rel="noopener">https://www.shellcheck.net/</a>.
</div>
<div class="footnote" id="_footnotedef_112">
<a href="#_footnoteref_112">112</a>. The <em>Debian Alquimist Shell</em>, a fork of the <em>Alquimist Shell</em>, is a very small, fast shell which is POSIX compatible. It provides the standard Shell <code>/bin/sh</code> on many modern Debian systems as well as on Ubuntu.
</div>
<div class="footnote" id="_footnotedef_113">
<a href="#_footnoteref_113">113</a>. <a href="https://github.com/gitbuch/buch-scripte" class="bare" target="_blank" rel="noopener">https://github.com/gitbuch/buch-scripte</a>
</div>
<div class="footnote" id="_footnotedef_114">
<a href="#_footnoteref_114">114</a>. There are other flags (<code>U</code>, <code>T</code> and <code>B</code>), but in practice they usually play no role.
</div>
<div class="footnote" id="_footnotedef_115">
<a href="#_footnoteref_115">115</a>. <a href="https://git.wiki.kernel.org/index.php/Aliases" class="bare" target="_blank" rel="noopener">https://git.wiki.kernel.org/index.php/Aliases</a>
</div>
<div class="footnote" id="_footnotedef_116">
<a href="#_footnoteref_116">116</a>. In principle, you <em>cannot</em> specify a predecessor. Then the corresponding commit becomes a root commit.
</div>








































</div>

<nav>
  <a rel="prev" href="Git-Book_8.html" class="nav nav-prev" title="Previous page" aria-label="Previous page" aria-keyshortcuts="Left">
        <i class="fa fa-angle-left"></i>
     </a>
  <a rel="next" href="Git-Book_10.html" class="nav nav-next" title="Next page" aria-label="Next page" aria-keyshortcuts="Right">
        <i class="fa fa-angle-right"></i>
     </a>
  <div style="clear: both"></div>
</nav>
<div id="footer">
<div id="footer-text">
Version 3.0<br>
</div>
</div>

</body>
  <script>
  function isInViewport(ele) {
    const rect = ele.getBoundingClientRect();
    return (
        rect.top >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)
    );
  }
  function yPosition (ele) {
    const rect = ele.getBoundingClientRect();
    return (rect.top - 20); // 20px above
  }
  let curr = document.getElementsByClassName('current');
  if (!isInViewport(curr[curr.length - 1])) {
    document.getElementById('toc').scrollTo({
      top: yPosition(curr[0]),
      left: 0,
      behavior: 'smooth'
    });
  }

  /* For page navigation */
  function gotoPage(selector) {
    const button = document.querySelector(selector);
    if (button)
      window.location.href = button.href;
  }
  document.addEventListener('keydown', e => {
    switch (e.key) {
      case 'ArrowRight':
        e.preventDefault();
        gotoPage('.nav-next');
        break;
      case 'ArrowLeft':
        e.preventDefault();
        gotoPage('.nav-prev');
        break;
    }
  });
  </script>
  </html>
